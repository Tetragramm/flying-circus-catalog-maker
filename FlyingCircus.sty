
\RequirePackage[a4paper, margin= 0.5in]{geometry}
\RequirePackage{graphicx}
\RequirePackage[normalem]{ulem}
\RequirePackage[T1]{fontenc}
\RequirePackage{nicematrix}
\RequirePackage{tikz}
\RequirePackage{multicol}
\RequirePackage{hyperref}
\RequirePackage{ragged2e}
\RequirePackage{fontspec}
\RequirePackage{nicefrac}
\RequirePackage{datatool}
\RequirePackage{fancyhdr}
\RequirePackage{contour}
\RequirePackage{newunicodechar}
\RequirePackage{xparse}
\RequirePackage{pgfkeys}
\RequirePackage[skins]{tcolorbox}
\RequirePackage[indent=0pt]{parskip}
\RequirePackage{etoc}
\RequirePackage{pgf-pie}

% Set up the link styles, shouldn't need to modify
\hypersetup{
    pdfinfo={
        PageMode=UseOutlines, 
        Creator=Tetragramm
        },
    final,
    hidelinks,
    linktoc=all,
    bookmarksdepth=4,
}

% Default paths for pictures
\graphicspath{{./images/} {./templates/}}

% Start in alpha page numbering
\pagenumbering{alph}

%%Load Fonts ==========================
%Load Normal Font
\setmainfont{Balthazar-Regular.ttf}[
  Path=./fonts/,
  AutoFakeSlant=0.2,
  Ligatures={{TeX}},
]
%Load icon font for propeller symbol
\newfontfamily\matdes{materialdesignicons-webfont.ttf}[
    Path=./fonts/,
    ]
%This is the propeller symbol
\newunicodechar{✣}{{\matdes \symbol{"F1A29}}}

%Load Flying Cirucs logo font
\newfontfamily\Kochfont{Koch-Fraktur.ttf}[
    Path=./fonts/,
    AutoFakeSlant=0.2,
    RawFeature=+shuffle,
    ]

% Define colors =====================
\definecolor{DarkGray}{gray}{0.4}
\definecolor{MidGray}{gray}{0.5}

% Default text behavior ========================
\DTLsetseparator{=}
\tolerance=1
\emergencystretch=\maxdimen
\hyphenpenalty=10000
\hbadness=10000

% Constants for the fancy outlined logo
\contourlength{2pt} %how thick each copy is
\contournumber{20}  %number of copies

%% Fancy header and footer=================================
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrule}{}
\renewcommand{\footrule}{}

\makeatletter
\def\@seccntformat#1{%
  \expandafter\ifx\csname c@#1\endcsname\c@section\else
  \csname the#1\endcsname\quad
  \fi}
\makeatother

\fancyhead[CE]{
    \begin{tikzpicture}
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.4\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.4\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.4\paperwidth,0) -- (0.4\paperwidth,0);
        \foreach \x in {
                -0.38, -0.37, -0.36, -0.35, -0.34, -0.33, -0.32, -0.31, -0.3, -0.29, -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38
            }
        \draw [line width=0.75mm] (\x\paperwidth-0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth+0.01\paperwidth,-0.01\paperwidth);
        \node (text) at (0,-0.003\paperwidth) {
            \contour{white}{\Kochfont\Large Flying Circus}
        };
    \end{tikzpicture}
}
\fancyhead[CO]{
    \begin{tikzpicture}
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.4\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.4\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.4\paperwidth,0) -- (0.4\paperwidth,0);
        \foreach \x in {
                -0.38, -0.37, -0.36, -0.35, -0.34, -0.33, -0.32, -0.31, -0.3, -0.29, -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38
            }
        \draw [line width=0.75mm] (\x\paperwidth+0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth-0.01\paperwidth,-0.01\paperwidth);
        \node (text) at (0,-0.003\paperwidth) {
            \contour{white}{\Kochfont\Large Flying Circus}
        };
    \end{tikzpicture}
}
\fancyfoot[LO]{
    \hspace{0.05\paperwidth} {\Kochfont\Large\thepage} \hspace{0.05\paperwidth}
    \begin{tikzpicture}
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.3\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.4\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.3\paperwidth,0) -- (0.4\paperwidth,0);
        \foreach \x in {
                -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38
            }
        \draw [line width=0.75mm] (\x\paperwidth+0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth-0.01\paperwidth,-0.01\paperwidth);
    \end{tikzpicture}
}

\fancyfoot[RE]{
    \begin{tikzpicture}
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.3\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.4\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.3\paperwidth,0) -- (0.4\paperwidth,0);
        \foreach \x in {
                -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38
            }
        \draw [line width=0.75mm] (\x\paperwidth+0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth-0.01\paperwidth,-0.01\paperwidth);
    \end{tikzpicture}
    \hspace{0.05\paperwidth} {\Kochfont\Large\thepage} \hspace{0.05\paperwidth}
}

\fancypagestyle{LancerFancyTOC}{%
\fancyhf{}
\renewcommand{\headrule}{}
\renewcommand{\footrule}{}
\fancyhead[C]{%The Left style header is on Odd pages
    \begin{tikzpicture}[remember picture, overlay]
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.4\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.4\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.4\paperwidth,0) -- (0.4\paperwidth,0);
        \foreach \x in {
                -0.38, -0.37, -0.36, -0.35, -0.34, -0.33, -0.32, -0.31, -0.3, -0.29, -0.28, -0.27, -0.26, -0.25, -0.24, -0.23, -0.22, -0.21, -0.2, -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.27, 0.28, 0.29, 0.3, 0.31, 0.32, 0.33, 0.34, 0.35, 0.36, 0.37, 0.38
            }
        \draw [line width=0.75mm] (\x\paperwidth-0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth+0.01\paperwidth,-0.01\paperwidth);
    \end{tikzpicture}
}
\fancyfoot[C]{%The Left style footer is on Odd pages
    \begin{tikzpicture}
        \node [draw, circle, fill=black, minimum size=3mm] (l) at (-0.2\paperwidth,0) {};
        \node [draw, circle, fill=black, minimum size=3mm] (r) at (0.2\paperwidth,0) {};
        \draw [line width=0.75mm] (-0.2\paperwidth,0) -- (0.2\paperwidth,0);
        \foreach \x in {
                -0.19, -0.18, -0.17, -0.16, -0.15, -0.14, -0.13, -0.12, -0.11, -0.1, -0.09, -0.08, -0.07, -0.06, -0.05, -0.04, -0.03, -0.02, -0.01, 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17, 0.18, 0.19
            }
        \draw [line width=0.75mm] (\x\paperwidth-0.01\paperwidth,0.01\paperwidth) -- (\x\paperwidth+0.01\paperwidth,-0.01\paperwidth);
    \end{tikzpicture}
}
}

\makeatother
%Custom command for inserting cover picture.  Try three different file formats.
\newcommand{\InsertFCCoverPicture}{
    \IfFileExists{./images/cover.png}{\includepdf{./images/cover.png}}{
        \IfFileExists{./images/cover.jpg}{\includepdf{./images/cover.jpg}}{
            \IfFileExists{./images/cover.bmp}{\includepdf{./images/cover.bmp}}{
                %No other options
            }
        }
    }
}

% Custom command for creating title page and table of contents.
\newcommand{\InsertFCTitleAndTOC}[2]{
{\let\cleardoublepage\clearpage
    \begin{titlepage}
        \thispagestyle{LancerFancyTOC}
        \begin{center}

            \vspace{0.1\pageheight}

            {
                \Kochfont\fontsize{75}{90}\selectfont
                Flying\\
                \reflectbox{\resizebox*{3\width}{3\height}{\rotatebox{90}{$\vartheta$}}}
                \Kochfont\fontsize{75}{90}\selectfont Circus
                \resizebox*{3\width}{3\height}{\rotatebox{90}{$\vartheta$}}
            }

            \normalfont\Huge
            Aircraft Catalogue\\
            #1\\
            \resizebox*{10\width}{3\height}{\rotatebox{90}{$\varsigma$}}
            \reflectbox{\resizebox*{10\width}{3\height}{\rotatebox{90}{$\varsigma$}}}

            \vspace*{\fill}

            #2\\

            \vspace*{0.05\pageheight}
        \end{center}
    \end{titlepage}
} %%% and here.


\begin{center}
\Huge\Kochfont Contents
\end{center}

\vspace{1cm}

\tableofcontents

\thispagestyle{fancy}
\newpage
\pagenumbering{arabic}
}

%%%%% Command for Making a Flying Circus Vehicle %%%%
% This is used for making magenta text to show when keys aren't being set.
\newcommand{\FrameDefault}[1]{\tcbox[colframe=magenta,colback=magenta,nobeforeafter,size=tight]{\textcolor{white}{#1}}}
% Define the keys for \Lancer Frame
% The \FrameDefalt shows when things aren't set.
\pgfkeys{
 /FCVehicle/.is family, FCVehicle,
 % Here are the options that a user can pass
 default/.style = 
    {Name = \FrameDefault{Flaktraktor-BC ``Flaktor''}, Price = \FrameDefault{25},
    Nickname = \FrameDefault{Buzz Off}, Upkeep = \FrameDefault{1},
    Speed = \FrameDefault{3}, Torque = \FrameDefault{+1}, Handling = \FrameDefault{15},
    Armour = \FrameDefault{2/2/1}, Integrity = \FrameDefault{20}, Safety = \FrameDefault{2},
    Reliability = \FrameDefault{0}, Fuel Uses = \FrameDefault{10}, Stress = \FrameDefault{1},
    Size = \FrameDefault{Large Size}, Cargo = \FrameDefault{Tiny Cargo},
    Crew = {}, Box Text = {}, Box Loc = {north east},
    Facing Image = {NoImageFound}
    },
    Name/.store in = \FCName,
    Name/.value required,
    Price/.store in = \FCPrice,
    Nickname/.store in = \FCNickname,
    Upkeep/.store in = \FCUpkeep,
    Speed/.store in = \FCSpeed,
    Torque/.store in = \FCTorque,
    Handling/.store in = \FCHandling,
    Armour/.store in = \FCArmour,
    Integrity/.store in = \FCIntegrity,
    Safety/.store in = \FCSafety,
    Reliability/.store in = \FCReliability,
    Fuel Uses/.store in = \FCFuelUses,
    Stress/.store in = \FCStress,
    Size/.store in = \FCSize,
    Cargo/.store in = \FCCargo,
    Crew/.store in = \FCCrew,
    Box Text/.store in = \FCBoxText,
    Box Loc/.store in = \FCBoxLoc,
    Facing Image/.store in = \FCFacingImage,
    Name/.value required,
    Price/.value required,
    Nickname/.value required,
    Upkeep/.value required,
    Speed/.value required,
    Torque/.value required,
    Handling/.value required,
    Armour/.value required,
    Integrity/.value required,
    Safety/.value required,
    Reliability/.value required,
    Fuel Uses/.value required,
    Stress/.value required,
    Size/.value required,
    Cargo/.value required,
    Crew/.value required,
    Box Text/.value required,
    Box Loc/.value required,
    Facing Image/.value required,
}
% Actual command
\newcommand{\FCVehicle}[2][]{%
    % Always starts on left page
    \cleardoublepage
    % Parse the keys passed in
    \pgfkeys{FCVehicle, default, #1}%
    \phantomsection\label{\FCFacingImage}
    \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=north, inner sep=0pt] (image) at (current page.north) {
            \includegraphics[width=\paperwidth, keepaspectratio]{\FCFacingImage}
        };
        \ifdefempty{\FCBoxText}{}{
            \node[draw,fill=white, fill opacity=0.7, text opacity=1, inner sep=0pt, outer sep=1cm, anchor=\FCBoxLoc] at (image.\FCBoxLoc) {
                    \large
                    \begin{NiceTabular}{l}[hvlines]
                    \FCBoxText
                    \end{NiceTabular}
        };}
    \end{tikzpicture}

    \phantom{Blah}
    \vspace{0.62\paperwidth}

    \phantomsection
    \addcontentsline{toc}{section}{ \FCName }
    \uline{{\huge \textcolor{DarkGray}{\FCName}}\hfill}
    \Large\normalfont\noindent\justify
    #2
    \clearpage
    \begin{center}
        \parbox[l]{0.6\textwidth}{\uline{\Huge\FCName\hfill\Large\FCPrice þ} \\ \FCNickname\hfill Upkeep \FCUpkeep þ}
        \begin{NiceTabular}{cccccc}[hvlines, columns-width=0.1\textwidth]
            \Block{1-2}{Speed} & & \Block{1-2}{Torque} &  & \Block{1-2}{Handling} &  \\
            \Block{1-2}{\FCSpeed} & & \Block{1-2}{\FCTorque} & & \Block{1-2}{\FCHandling} \\
            \Block{1-2}{Armour} & & \Block{1-2}{Integrity} &  & \Block{1-2}{Safety} &  \\
            \Block{1-2}{\FCArmour} &  & \Block{1-2}{\FCIntegrity} &  & \Block{1-2}{\FCSafety} &  \\
            \Block{1-2}{Reliability} &  & \Block{1-2}{Fuel Uses} &  & \Block{1-2}{Stress} &  \\
            \Block{1-2}{\FCReliability} &  & \Block{1-2}{\FCFuelUses} &  & \Block{1-2}{\FCStress} &  \\
            \Block{1-3}{\FCSize} & & & \Block{1-3}{\FCCargo} & & \\
        \end{NiceTabular}
        
        \vspace{1cm}

        {\LARGE\Kochfont Crew}

        \begin{NiceTabular}[width=\textwidth]{lcccX}[hvlines, corners]
             & Type & Vis. & Escape & Notes\\
            \FCCrew
        \end{NiceTabular}
    \end{center}
}

% Define the keys for \Lancer Frame
% The \FrameDefalt shows when things aren't set.
\pgfkeys{
 /FCPlane/.is family, FCPlane,
 % Here are the options that a user can pass
 default/.style = 
    {Name = \FrameDefault{Flaktraktor-BC ``Flaktor''}, Price = \FrameDefault{25},
    Nickname = \FrameDefault{Buzz Off}, Upkeep = \FrameDefault{1},
    Stats = {Failure & 0 & 0 & 0 & 0 & 0 \\}, Vital Parts = \FrameDefault{Engine?}, Crew = \FrameDefault{Pilot?},
    Propulsion = {}, Aerodynamics = {}, Survivability = {}, Armament = {},
    Image = {NoImageFound}, Link = {}, Box Loc = {south east}, Box Text = {},
    },
    Name/.store in = \FCName,
    Price/.store in = \FCPrice,
    Nickname/.store in = \FCNickname,
    Upkeep/.store in = \FCUpkeep,
    Stats/.store in = \FCStats,
    Vital Parts/.store in = \FCVitalParts,
    Crew/.store in = \FCCrew,
    Propulsion/.store in = \FCPropulsion,
    Aerodynamics/.store in = \FCAerodynamics,
    Survivability/.store in = \FCSurvivability,
    Armament/.store in = \FCArmament,
    Image/.store in = \FCImage,
    Link/.store in = \FCLink,
    Box Loc/.store in = \FCBoxLoc,
    Box Text/.store in = \FCBoxText,
}
\newcommand{\FCPlane}[2][]{
    \clearpage
    \pgfkeys{FCPlane, default, #1}%

    \begin{center}
        \begin{tikzpicture}
                \node (image) at (0,0) {
                        \includegraphics[width=\textwidth, height=0.33\textheight, keepaspectratio]{\FCImage}
                };

                \ifdefempty{\FCBoxText}{}{
                    \node[draw,fill=white, fill opacity=0.7, text opacity=1, inner sep=0pt,anchor=\FCBoxLoc] at (image.\FCBoxLoc) {
                            \large
                            \begin{NiceTabular}{cc}[hvlines]
                                \FCBoxText
                            \end{NiceTabular}};
                }
        \end{tikzpicture}
    \end{center}
    \par
    \phantomsection
    \addcontentsline{toc}{section}{ \FCName }
    \uline{{\huge \textcolor{DarkGray}{\FCName}}
            \hfill
            \large \textcolor{MidGray}{\FCPrice þ Used}}

    \Large \textcolor{DarkGray}{\textit{``\FCNickname''}} \hfill \large \textcolor{MidGray}{\FCUpkeep þ Upkeep}

    \large
    \begin{NiceTabular}{ccccc}[first-row, first-col, hvlines, rules/width=1pt]
             & Boost & Handling & Climb & Stall & Speed \\
            \FCStats
    \end{NiceTabular}
    \quad
    \begin{NiceTabular}{c}[first-row, hvlines, rules/width=1pt]
            Vital Parts\\
            \parbox{0.4\textwidth}{
                    \centering
                    \vspace{.5\baselineskip}
            \FCVitalParts \\
            \FCCrew
                    \vspace{.5\baselineskip}
            }
    \end{NiceTabular}
    \par
    \vspace{\baselineskip}
    \centering
    \begin{NiceTabular}{c}[columns-width=0.9\textwidth,hvlines, rules/width=1pt]
            \FCPropulsion \\
            \FCAerodynamics \\
            \FCSurvivability \\
            \parbox{0.9\textwidth}{
                    \raggedright
                    \vspace{.5\baselineskip}
            \FCArmament
                    \vspace{.5\baselineskip}
            }
    \end{NiceTabular}
    \par
    \begin{multicols}{2}
            \large
            \justify
            #2
    \end{multicols}

    \vspace*{\fill}

    \begin{center}
            \href{\FCLink}{\centering \Huge \underline{Plane Builder Link}}
    \end{center}
}

% Define the keys for \Lancer Frame
% The \FrameDefalt shows when things aren't set.
\pgfkeys{
 /FCShip/.is family, FCShip,
 % Here are the options that a user can pass
 default/.style = {
    Name = \FrameDefault{Flaktraktor-BC ``Flaktor''}, Notes = {How many Crew?},
    Speed = \FrameDefault{2}, Handling = \FrameDefault{-10},
    Hardness = \FrameDefault{7}, Soak = \FrameDefault{0},
    Strengths = \FrameDefault{-}, Weaknesses = \FrameDefault{-},
    Vital Parts = {
                    1/ \hfill,
                    1/Sinking,
                },
    Armament = {},
    Image = {NoImageFound},
    },
    Name/.store in = \FCName,
    Notes/.store in = \FCNotes,
    Speed/.store in = \FCSpeed,
    Handling/.store in = \FCHandling,
    Hardness/.store in = \FCHardness,
    Soak/.store in = \FCSoak,
    Strengths/.store in = \FCStrengths,
    Weaknesses/.store in = \FCWeaknesses,
    Vital Parts/.store in = \FCVitalParts,
    Armament/.store in = \FCArmament,
    Image/.store in = \FCImage,
}
\newcommand{\FCShip}[2][]{
    \clearpage
    \pgfkeys{FCShip, default, #1}%

    \begin{center}
        \begin{tikzpicture}
                \node (image) at (0,0) {
                        \includegraphics[width=\textwidth, height=0.33\textheight, keepaspectratio]{\FCImage}
                };
        \end{tikzpicture}
    \end{center}
    \par
    \phantomsection
    \addcontentsline{toc}{section}{ \FCName }
    \begin{Kochfont}
        \Huge \FCName
    \end{Kochfont}

    \Large
    #2

    \vfill

    \begin{NiceTabular}{|Wc{0.3\textwidth}|Wc{0.3\textwidth}Wc{0.15\textwidth}}[hlines,rules/width=1pt]
        Speed        & Handling      & \\
        \FCSpeed     & \FCHandling   & \\
        Hardness     & Soak          & \\
        \FCHardness  & \FCSoak       & \\
        Strengths    & Weaknesses    & \\
        \FCStrengths & \FCWeaknesses & \\
        \CodeAfter
        \begin{tikzpicture}[pos=3-3]
                \pie[color=white, hide number, text=inside, sum=auto, rotate=90, change direction]{
                    \FCVitalParts
                % 1/,
                % 1/-2 Guns,
                % 1/-1 Speed,
                % 1/-2 Guns,
                % 1/-2 Guns,
                % 1/-2 Guns,
                % 1/-1 Speed,
                % 1/Sinking
                }
        \end{tikzpicture}
    \end{NiceTabular}

    \vspace{1em}
    
    \ifdefempty{\FCArmament}{}{
    \begin{center}
        \begin{Kochfont}
                \LARGE Weapons
        \end{Kochfont}
    \end{center}
    \vspace{0.5em}
    \begin{NiceTabular}{X[2,l]X[c]X[c]X[c]X[c]X[c]}[rules/width=1pt, hvlines, corners]
             & Fore & Left & Right & Rear & Up \\
            \FCArmament
    \end{NiceTabular}
    }

    \ifdefempty{\FCNotes}{}{
        \begin{center}
                \begin{Kochfont}
                        \LARGE Notes
                \end{Kochfont}
        \end{center}

        \FCNotes
    }
}

\etocsettocstyle{}{}
\etocsetstyle{section}
    {}
    {}
    {\textbf{\huge\etocthename\dotfill\etocpage}\par\vspace{2em}}
    {}

\directlua
{
 fonts.handlers.otf.addfeature
  {
    name = "shuffle",
    type = "multiple",
    data =
      {
          ["s"] = {"$"},
      },
  }
}